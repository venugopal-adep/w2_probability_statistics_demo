{% extends "base.html" %}

{% block title %}Uniform Distribution - Probability Distributions{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="card mb-3">
            <div class="card-body">
                <h1 class="display-5 mb-3">
                    <i class="fas fa-equals text-info me-2"></i>
                    Uniform Distribution Interactive Explorer
                </h1>
                <p class="lead">Explore both discrete and continuous uniform distributions with interactive visualizations, probability calculations, and real-time simulations.</p>
                
                <!-- Quick Action Buttons -->
                <div class="row g-2 mt-2">
                    <div class="col-md-2">
                        <button id="diceExample" class="btn btn-outline-primary btn-sm w-100">
                            <i class="fas fa-dice me-1"></i>Dice (1-6)
                        </button>
                    </div>
                    <div class="col-md-2">
                        <button id="coinExample" class="btn btn-outline-info btn-sm w-100">
                            <i class="fas fa-coins me-1"></i>Coin (0-1)
                        </button>
                    </div>
                    <div class="col-md-2">
                        <button id="timeExample" class="btn btn-outline-success btn-sm w-100">
                            <i class="fas fa-clock me-1"></i>Time (0-60min)
                        </button>
                    </div>
                    <div class="col-md-2">
                        <button id="compareMode" class="btn btn-outline-warning btn-sm w-100">
                            <i class="fas fa-exchange-alt me-1"></i>Compare Two
                        </button>
                    </div>
                    <div class="col-md-2">
                        <button id="simulationMode" class="btn btn-outline-danger btn-sm w-100">
                            <i class="fas fa-play me-1"></i>Simulation
                        </button>
                    </div>
                    <div class="col-md-2">
                        <button id="resetAll" class="btn btn-outline-secondary btn-sm w-100">
                            <i class="fas fa-undo me-1"></i>Reset
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- MCQ Quiz 1: Introduction to Uniform Distribution -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card border-info">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0"><i class="fas fa-question-circle me-2"></i>Quiz 1: Uniform Distribution Basics</h5>
            </div>
            <div class="card-body">
                <p><strong>What is the main characteristic of a uniform distribution?</strong></p>
                <div class="quiz-options">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="quiz1" id="quiz1a" value="a">
                        <label class="form-check-label" for="quiz1a">
                            All outcomes have equal probability
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="quiz1" id="quiz1b" value="b">
                        <label class="form-check-label" for="quiz1b">
                            Some outcomes are more likely than others
                        </label>
                    </div>
                </div>
                <button class="btn btn-info btn-sm mt-2" onclick="checkQuiz('quiz1', 'a', 'Correct! Uniform distribution means all outcomes within the range have equal probability.')">Check Answer</button>
                <div id="quiz1-feedback" class="quiz-feedback mt-2"></div>
            </div>
        </div>
    </div>
</div>

<!-- Main Control Panel -->
<div class="row">
    <div class="col-lg-8">
        <div class="card mb-3">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4><i class="fas fa-sliders-h text-primary me-2"></i>Distribution Controls</h4>
                    <div class="d-flex gap-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="discreteSwitch">
                            <label class="form-check-label" for="discreteSwitch">Discrete Mode</label>
                        </div>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="showGrid" checked>
                            <label class="form-check-label" for="showGrid">Show Grid</label>
                        </div>
                    </div>
                </div>
                
                <!-- Primary Distribution Controls -->
                <div id="primaryControls" class="border p-3 rounded mb-3" style="border-color: #0d6efd !important;">
                    <h6 class="text-primary mb-3">
                        <i class="fas fa-chart-line me-1"></i>Primary Distribution
                        <span id="primaryLabel" class="badge bg-primary ms-2">Uniform(0, 1)</span>
                    </h6>
                    <div class="row">
                        <div class="col-md-6">
                            <label for="minValue" class="form-label">Minimum Value (a):</label>
                            <div class="input-group">
                                <input type="range" class="form-range" id="minValue" min="0" max="50" step="0.1" value="0">
                                <input type="number" class="form-control form-control-sm" id="minInput" min="0" max="50" step="0.1" value="0" style="max-width: 80px;">
                            </div>
                            <div class="text-center mt-1">
                                <span id="minValueDisplay" class="badge bg-primary">0</span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label for="maxValue" class="form-label">Maximum Value (b):</label>
                            <div class="input-group">
                                <input type="range" class="form-range" id="maxValue" min="1" max="50" step="0.1" value="10">
                                <input type="number" class="form-control form-control-sm" id="maxInput" min="1" max="50" step="0.1" value="10" style="max-width: 80px;">
                            </div>
                            <div class="text-center mt-1">
                                <span id="maxValueDisplay" class="badge bg-success">10</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Comparison Controls (Hidden by default) -->
                <div id="comparisonControls" class="border p-3 rounded mb-3 d-none" style="border-color: #dc3545 !important;">
                    <h6 class="text-danger mb-3">
                        <i class="fas fa-chart-line me-1"></i>Comparison Distribution
                        <span id="comparisonLabel" class="badge bg-danger ms-2">Uniform(5, 15)</span>
                    </h6>
                    <div class="row">
                        <div class="col-md-6">
                            <label for="minValue2" class="form-label">Minimum Value (a₂):</label>
                            <div class="input-group">
                                <input type="range" class="form-range" id="minValue2" min="0" max="50" step="0.1" value="5">
                                <input type="number" class="form-control form-control-sm" id="minInput2" min="0" max="50" step="0.1" value="5" style="max-width: 80px;">
                            </div>
                            <div class="text-center mt-1">
                                <span id="minValue2Display" class="badge bg-danger">5</span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label for="maxValue2" class="form-label">Maximum Value (b₂):</label>
                            <div class="input-group">
                                <input type="range" class="form-range" id="maxValue2" min="1" max="50" step="0.1" value="15">
                                <input type="number" class="form-control form-control-sm" id="maxInput2" min="1" max="50" step="0.1" value="15" style="max-width: 80px;">
                            </div>
                            <div class="text-center mt-1">
                                <span id="maxValue2Display" class="badge bg-warning">15</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Visualization Options -->
                <div class="row">
                    <div class="col-md-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="showMean">
                            <label class="form-check-label" for="showMean">
                                Show Mean
                            </label>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="showQuartiles">
                            <label class="form-check-label" for="showQuartiles">
                                Show Quartiles
                            </label>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="showProbabilities">
                            <label class="form-check-label" for="showProbabilities">
                                Show Probabilities
                            </label>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="showCDF">
                            <label class="form-check-label" for="showCDF">
                                Show CDF
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- MCQ Quiz 2: Distribution Parameters -->
        <div class="card border-primary mb-3">
            <div class="card-header bg-primary text-white">
                <h6 class="mb-0"><i class="fas fa-question-circle me-2"></i>Quiz 2: Distribution Parameters</h6>
            </div>
            <div class="card-body">
                <p><strong>In a uniform distribution U(a,b), what do 'a' and 'b' represent?</strong></p>
                <div class="quiz-options">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="quiz2" id="quiz2a" value="a">
                        <label class="form-check-label" for="quiz2a">
                            The minimum and maximum values of the range
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="quiz2" id="quiz2b" value="b">
                        <label class="form-check-label" for="quiz2b">
                            The mean and standard deviation
                        </label>
                    </div>
                </div>
                <button class="btn btn-primary btn-sm mt-2" onclick="checkQuiz('quiz2', 'a', 'Correct! In U(a,b), a is the minimum value and b is the maximum value of the distribution.')">Check Answer</button>
                <div id="quiz2-feedback" class="quiz-feedback mt-2"></div>
            </div>
        </div>

        <!-- Main Plot -->
        <div class="card mb-3">
            <div class="card-body">
                <div id="plotContainer" class="text-center">
                    <img id="uniformPlot" src="" alt="Uniform Distribution Plot" class="img-fluid" style="display: none;">
                    <div id="loadingSpinner" class="d-none">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Probability Calculator -->
        <div class="card mb-3">
            <div class="card-body">
                <h5><i class="fas fa-calculator text-success me-2"></i>Probability Calculator</h5>
                <div class="row">
                    <div class="col-md-4">
                        <label for="probType" class="form-label">Calculate:</label>
                        <select class="form-select" id="probType">
                            <option value="less">P(X < value)</option>
                            <option value="greater">P(X > value)</option>
                            <option value="between">P(a ≤ X ≤ b)</option>
                            <option value="equal">P(X = value)</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="probValue1" class="form-label">Value (a):</label>
                        <input type="number" class="form-control" id="probValue1" value="5" step="0.1">
                    </div>
                    <div class="col-md-3" id="probValue2Container" style="display: none;">
                        <label for="probValue2" class="form-label">Value (b):</label>
                        <input type="number" class="form-control" id="probValue2" value="8" step="0.1">
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">&nbsp;</label>
                        <button id="calculateProb" class="btn btn-success w-100">Calculate</button>
                    </div>
                </div>
                <div id="probResult" class="mt-3 p-3 bg-light rounded d-none">
                    <h6>Result:</h6>
                    <div id="probResultText"></div>
                </div>
            </div>
        </div>

        <!-- MCQ Quiz 3: Probability Calculations -->
        <div class="card border-success mb-3">
            <div class="card-header bg-success text-white">
                <h6 class="mb-0"><i class="fas fa-question-circle me-2"></i>Quiz 3: Probability in Uniform Distribution</h6>
            </div>
            <div class="card-body">
                <p><strong>For a continuous uniform distribution U(0,10), what is P(X = 5)?</strong></p>
                <div class="quiz-options">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="quiz3" id="quiz3a" value="a">
                        <label class="form-check-label" for="quiz3a">
                            0 (zero)
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="quiz3" id="quiz3b" value="b">
                        <label class="form-check-label" for="quiz3b">
                            0.1 (one-tenth)
                        </label>
                    </div>
                </div>
                <button class="btn btn-success btn-sm mt-2" onclick="checkQuiz('quiz3', 'a', 'Correct! For continuous distributions, probability at any exact point is zero.')">Check Answer</button>
                <div id="quiz3-feedback" class="quiz-feedback mt-2"></div>
            </div>
        </div>

        <!-- Simulation Panel -->
        <div class="card mb-3" id="simulationPanel" style="display: none;">
            <div class="card-body">
                <h5><i class="fas fa-play text-danger me-2"></i>Monte Carlo Simulation</h5>
                <div class="row">
                    <div class="col-md-4">
                        <label for="simSamples" class="form-label">Number of Samples:</label>
                        <input type="range" class="form-range" id="simSamples" min="100" max="10000" step="100" value="1000">
                        <div class="text-center">
                            <span id="simSamplesValue" class="badge bg-info">1000</span>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <label for="simBins" class="form-label">Histogram Bins:</label>
                        <input type="range" class="form-range" id="simBins" min="10" max="50" step="5" value="20">
                        <div class="text-center">
                            <span id="simBinsValue" class="badge bg-secondary">20</span>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="d-grid gap-2">
                            <label class="form-label">&nbsp;</label>
                            <button id="runSimulation" class="btn btn-danger">
                                <i class="fas fa-play me-1"></i>Run Simulation
                            </button>
                        </div>
                    </div>
                </div>
                <div id="simulationResults" class="mt-3 d-none">
                    <div class="row text-center">
                        <div class="col-md-3">
                            <div class="border rounded p-2">
                                <small class="text-muted">Sample Mean</small>
                                <div id="simMean" class="fw-bold"></div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="border rounded p-2">
                                <small class="text-muted">Sample Variance</small>
                                <div id="simVariance" class="fw-bold"></div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="border rounded p-2">
                                <small class="text-muted">Theoretical Mean</small>
                                <div id="theoreticalMean" class="fw-bold"></div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="border rounded p-2">
                                <small class="text-muted">Theoretical Variance</small>
                                <div id="theoreticalVariance" class="fw-bold"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Side Panel -->
    <div class="col-lg-4">
        <!-- Distribution Type Selector -->
        <div class="card mb-3">
            <div class="card-body">
                <h5><i class="fas fa-toggle-on text-info me-2"></i>Distribution Type</h5>
                <div class="row">
                    <div class="col-6">
                        <div class="border rounded p-3 text-center" id="discreteCard">
                            <i class="fas fa-list-ol fa-2x text-primary mb-2"></i>
                            <h6>Discrete</h6>
                            <small class="text-muted">Finite outcomes</small>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="border rounded p-3 text-center" id="continuousCard">
                            <i class="fas fa-wave-square fa-2x text-success mb-2"></i>
                            <h6>Continuous</h6>
                            <small class="text-muted">Infinite outcomes</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- MCQ Quiz 4: Discrete vs Continuous -->
        <div class="card border-warning mb-3">
            <div class="card-header bg-warning text-dark">
                <h6 class="mb-0"><i class="fas fa-question-circle me-2"></i>Quiz 4: Discrete vs Continuous Uniform</h6>
            </div>
            <div class="card-body">
                <p><strong>What is the difference between discrete and continuous uniform distributions?</strong></p>
                <div class="quiz-options">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="quiz4" id="quiz4a" value="a">
                        <label class="form-check-label" for="quiz4a">
                            Discrete has finite outcomes, continuous has infinite outcomes
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="quiz4" id="quiz4b" value="b">
                        <label class="form-check-label" for="quiz4b">
                            They are exactly the same
                        </label>
                    </div>
                </div>
                <button class="btn btn-warning btn-sm mt-2" onclick="checkQuiz('quiz4', 'a', 'Correct! Discrete uniform has countable outcomes, while continuous has uncountable outcomes.')">Check Answer</button>
                <div id="quiz4-feedback" class="quiz-feedback mt-2"></div>
            </div>
        </div>

        <!-- Current Distribution Stats -->
        <div class="card mb-3">
            <div class="card-body">
                <h5><i class="fas fa-chart-bar text-info me-2"></i>Distribution Statistics</h5>
                <div id="statsContainer">
                    <div class="row text-center">
                        <div class="col-6">
                            <div class="border rounded p-2">
                                <h6 class="text-primary mb-1">Mean (μ)</h6>
                                <span id="statMean" class="h5">5.0</span>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="border rounded p-2">
                                <h6 class="text-success mb-1">Variance (σ²)</h6>
                                <span id="statVariance" class="h5">8.33</span>
                            </div>
                        </div>
                    </div>
                    <div class="row text-center mt-2">
                        <div class="col-6">
                            <div class="border rounded p-2">
                                <h6 class="text-warning mb-1">Std Dev (σ)</h6>
                                <span id="statStd" class="h5">2.89</span>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="border rounded p-2">
                                <h6 class="text-info mb-1">Range</h6>
                                <span id="statRange" class="h5">10</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Properties -->
        <div class="card mb-3">
            <div class="card-body">
                <h5><i class="fas fa-list-ul text-info me-2"></i>Properties</h5>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item d-flex justify-content-between">
                        <span><i class="fas fa-check text-success me-2"></i>Equal probabilities</span>
                        <span class="badge bg-success">✓</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between">
                        <span><i class="fas fa-check text-success me-2"></i>Flat distribution</span>
                        <span class="badge bg-success">✓</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between">
                        <span><i class="fas fa-check text-success me-2"></i>Symmetric</span>
                        <span class="badge bg-success">✓</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between">
                        <span id="domainText"><i class="fas fa-ruler text-primary me-2"></i>Domain: [0, 10]</span>
                        <span class="badge bg-primary">Finite</span>
                    </li>
                </ul>
            </div>
        </div>

        <!-- MCQ Quiz 5: Properties -->
        <div class="card border-info mb-3">
            <div class="card-header bg-info text-white">
                <h6 class="mb-0"><i class="fas fa-question-circle me-2"></i>Quiz 5: Uniform Distribution Properties</h6>
            </div>
            <div class="card-body">
                <p><strong>What is the mean of a uniform distribution U(a,b)?</strong></p>
                <div class="quiz-options">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="quiz5" id="quiz5a" value="a">
                        <label class="form-check-label" for="quiz5a">
                            (a + b) / 2
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="quiz5" id="quiz5b" value="b">
                        <label class="form-check-label" for="quiz5b">
                            (b - a) / 2
                        </label>
                    </div>
                </div>
                <button class="btn btn-info btn-sm mt-2" onclick="checkQuiz('quiz5', 'a', 'Correct! The mean is the midpoint between the minimum and maximum values.')">Check Answer</button>
                <div id="quiz5-feedback" class="quiz-feedback mt-2"></div>
            </div>
        </div>

        <!-- Real-World Examples -->
        <div class="card mb-3">
            <div class="card-body">
                <h5><i class="fas fa-lightbulb text-success me-2"></i>Real-World Examples</h5>
                <div class="row g-2">
                    <div class="col-12">
                        <button class="btn btn-outline-primary btn-sm w-100" onclick="setExample('dice')">
                            <i class="fas fa-dice me-1"></i>Dice Roll (1-6)
                        </button>
                    </div>
                    <div class="col-12">
                        <button class="btn btn-outline-info btn-sm w-100" onclick="setExample('card')">
                            <i class="fas fa-address-card me-1"></i>Card Draw (1-13)
                        </button>
                    </div>
                    <div class="col-12">
                        <button class="btn btn-outline-success btn-sm w-100" onclick="setExample('time')">
                            <i class="fas fa-clock me-1"></i>Bus Arrival (0-15 min)
                        </button>
                    </div>
                    <div class="col-12">
                        <button class="btn btn-outline-warning btn-sm w-100" onclick="setExample('random')">
                            <i class="fas fa-random me-1"></i>Random Number (0-1)
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- MCQ Quiz 6: Real-World Applications -->
        <div class="card border-success mb-3">
            <div class="card-header bg-success text-white">
                <h6 class="mb-0"><i class="fas fa-question-circle me-2"></i>Quiz 6: Real-World Applications</h6>
            </div>
            <div class="card-body">
                <p><strong>Which of these is a good example of a discrete uniform distribution?</strong></p>
                <div class="quiz-options">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="quiz6" id="quiz6a" value="a">
                        <label class="form-check-label" for="quiz6a">
                            Rolling a fair six-sided die
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="quiz6" id="quiz6b" value="b">
                        <label class="form-check-label" for="quiz6b">
                            Measuring someone's exact height
                        </label>
                    </div>
                </div>
                <button class="btn btn-success btn-sm mt-2" onclick="checkQuiz('quiz6', 'a', 'Correct! A die has finite, equally likely outcomes (1,2,3,4,5,6).')">Check Answer</button>
                <div id="quiz6-feedback" class="quiz-feedback mt-2"></div>
            </div>
        </div>

        <!-- Formulas -->
        <div class="card">
            <div class="card-body">
                <h5><i class="fas fa-calculator text-warning me-2"></i>Mathematical Formulas</h5>
                
                <div class="mb-3" id="discreteFormulas">
                    <h6 class="text-primary">Discrete Uniform:</h6>
                    <div class="bg-light p-2 rounded mb-2">
                        <strong>PMF:</strong> P(X = k) = 1/n
                    </div>
                    <div class="bg-light p-2 rounded mb-2">
                        <strong>Mean:</strong> μ = (a + b)/2
                    </div>
                    <div class="bg-light p-2 rounded">
                        <strong>Variance:</strong> σ² = ((b-a+1)²-1)/12
                    </div>
                </div>

                <div class="mb-3" id="continuousFormulas">
                    <h6 class="text-success">Continuous Uniform:</h6>
                    <div class="bg-light p-2 rounded mb-2">
                        <strong>PDF:</strong> f(x) = 1/(b-a) for a ≤ x ≤ b
                    </div>
                    <div class="bg-light p-2 rounded mb-2">
                        <strong>Mean:</strong> μ = (a + b)/2
                    </div>
                    <div class="bg-light p-2 rounded">
                        <strong>Variance:</strong> σ² = (b-a)²/12
                    </div>
                </div>
            </div>
        </div>

        <!-- MCQ Quiz 7: Mathematical Formulas -->
        <div class="card border-danger mt-3">
            <div class="card-header bg-danger text-white">
                <h6 class="mb-0"><i class="fas fa-question-circle me-2"></i>Quiz 7: Mathematical Formulas</h6>
            </div>
            <div class="card-body">
                <p><strong>For a continuous uniform distribution U(a,b), what is the PDF f(x)?</strong></p>
                <div class="quiz-options">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="quiz7" id="quiz7a" value="a">
                        <label class="form-check-label" for="quiz7a">
                            f(x) = 1/(b-a) for a ≤ x ≤ b
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="quiz7" id="quiz7b" value="b">
                        <label class="form-check-label" for="quiz7b">
                            f(x) = (b-a)/2 for a ≤ x ≤ b
                        </label>
                    </div>
                </div>
                <button class="btn btn-danger btn-sm mt-2" onclick="checkQuiz('quiz7', 'a', 'Correct! The PDF is constant at 1/(b-a) over the interval [a,b].')">Check Answer</button>
                <div id="quiz7-feedback" class="quiz-feedback mt-2"></div>
            </div>
        </div>
    </div>
</div>

<!-- MCQ Quiz 8: Simulation and Practical Applications -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card border-secondary">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0"><i class="fas fa-question-circle me-2"></i>Quiz 8: Simulation and Applications</h5>
            </div>
            <div class="card-body">
                <p><strong>When might you use a uniform distribution in real-world modeling?</strong></p>
                <div class="quiz-options">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="quiz8" id="quiz8a" value="a">
                        <label class="form-check-label" for="quiz8a">
                            When you have no reason to believe any value is more likely than others
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="quiz8" id="quiz8b" value="b">
                        <label class="form-check-label" for="quiz8b">
                            When most values cluster around the center
                        </label>
                    </div>
                </div>
                <button class="btn btn-secondary btn-sm mt-2" onclick="checkQuiz('quiz8', 'a', 'Correct! Uniform distribution represents maximum uncertainty - all values equally likely.')">Check Answer</button>
                <div id="quiz8-feedback" class="quiz-feedback mt-2"></div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Quiz functionality
function checkQuiz(quizName, correctAnswer, successMessage) {
    const selectedAnswer = document.querySelector(`input[name="${quizName}"]:checked`);
    const feedbackDiv = document.getElementById(`${quizName}-feedback`);
    
    if (!selectedAnswer) {
        feedbackDiv.innerHTML = '<div class="alert alert-warning">Please select an answer!</div>';
        return;
    }
    
    if (selectedAnswer.value === correctAnswer) {
        feedbackDiv.innerHTML = `<div class="alert alert-success"><i class="fas fa-check-circle me-2"></i>${successMessage}</div>`;
    } else {
        feedbackDiv.innerHTML = '<div class="alert alert-danger"><i class="fas fa-times-circle me-2"></i>Incorrect. Try again!</div>';
    }
}

document.addEventListener('DOMContentLoaded', function() {
    // Get all the DOM elements
    const discreteSwitch = document.getElementById('discreteSwitch');
    const minSlider = document.getElementById('minValue');
    const maxSlider = document.getElementById('maxValue');
    const minInput = document.getElementById('minInput');
    const maxInput = document.getElementById('maxInput');
    const minDisplay = document.getElementById('minValueDisplay');
    const maxDisplay = document.getElementById('maxValueDisplay');
    
    // Comparison controls
    const minSlider2 = document.getElementById('minValue2');
    const maxSlider2 = document.getElementById('maxValue2');
    const minInput2 = document.getElementById('minInput2');
    const maxInput2 = document.getElementById('maxInput2');
    const minDisplay2 = document.getElementById('minValue2Display');
    const maxDisplay2 = document.getElementById('maxValue2Display');
    
    // UI elements
    const plotImage = document.getElementById('uniformPlot');
    const loadingSpinner = document.getElementById('loadingSpinner');
    const comparisonControls = document.getElementById('comparisonControls');
    const primaryLabel = document.getElementById('primaryLabel');
    const comparisonLabel = document.getElementById('comparisonLabel');
    const simulationPanel = document.getElementById('simulationPanel');
    
    // Buttons
    const diceExampleBtn = document.getElementById('diceExample');
    const coinExampleBtn = document.getElementById('coinExample');
    const timeExampleBtn = document.getElementById('timeExample');
    const compareModeBtn = document.getElementById('compareMode');
    const simulationModeBtn = document.getElementById('simulationMode');
    const resetAllBtn = document.getElementById('resetAll');
    
    // Checkboxes and options
    const showMean = document.getElementById('showMean');
    const showQuartiles = document.getElementById('showQuartiles');
    const showProbabilities = document.getElementById('showProbabilities');
    const showCDF = document.getElementById('showCDF');
    const showGrid = document.getElementById('showGrid');
    
    // Probability calculator
    const probType = document.getElementById('probType');
    const probValue1 = document.getElementById('probValue1');
    const probValue2 = document.getElementById('probValue2');
    const probValue2Container = document.getElementById('probValue2Container');
    const calculateProbBtn = document.getElementById('calculateProb');
    const probResult = document.getElementById('probResult');
    const probResultText = document.getElementById('probResultText');
    
    // Simulation controls
    const simSamples = document.getElementById('simSamples');
    const simSamplesValue = document.getElementById('simSamplesValue');
    const simBins = document.getElementById('simBins');
    const simBinsValue = document.getElementById('simBinsValue');
    const runSimulationBtn = document.getElementById('runSimulation');
    const simulationResults = document.getElementById('simulationResults');
    
    // Stats display
    const statMean = document.getElementById('statMean');
    const statVariance = document.getElementById('statVariance');
    const statStd = document.getElementById('statStd');
    const statRange = document.getElementById('statRange');
    const domainText = document.getElementById('domainText');
    const discreteCard = document.getElementById('discreteCard');
    const continuousCard = document.getElementById('continuousCard');

    let updateTimeout;
    let isInitialLoad = true;
    let comparisonMode = false;
    let simulationMode = false;

    // Utility functions
    function updateStats() {
        const a = parseFloat(minSlider.value);
        const b = parseFloat(maxSlider.value);
        const isDiscrete = discreteSwitch.checked;
        
        const mean = (a + b) / 2;
        const range = b - a;
        let variance, std;
        
        if (isDiscrete) {
            const n = Math.floor(b) - Math.floor(a) + 1;
            variance = ((n * n) - 1) / 12;
        } else {
            variance = (range * range) / 12;
        }
        std = Math.sqrt(variance);
        
        statMean.textContent = mean.toFixed(2);
        statVariance.textContent = variance.toFixed(2);
        statStd.textContent = std.toFixed(2);
        statRange.textContent = range.toFixed(1);
        
        // Update domain text
        domainText.innerHTML = `<i class="fas fa-ruler text-primary me-2"></i>Domain: [${a}, ${b}]`;
        
        // Update labels
        primaryLabel.textContent = `Uniform(${a}, ${b})`;
        if (comparisonMode) {
            const a2 = parseFloat(minSlider2.value);
            const b2 = parseFloat(maxSlider2.value);
            comparisonLabel.textContent = `Uniform(${a2}, ${b2})`;
        }
        
        // Update distribution type cards
        if (isDiscrete) {
            discreteCard.classList.add('bg-primary', 'text-white');
            continuousCard.classList.remove('bg-success', 'text-white');
        } else {
            continuousCard.classList.add('bg-success', 'text-white');
            discreteCard.classList.remove('bg-primary', 'text-white');
        }
    }

    function updateSliderSteps() {
        const isDiscrete = discreteSwitch.checked;
        const step = isDiscrete ? "1" : "0.1";
        
        [minSlider, maxSlider, minSlider2, maxSlider2].forEach(slider => {
            if (slider) slider.step = step;
        });
        
        [minInput, maxInput, minInput2, maxInput2].forEach(input => {
            if (input) input.step = step;
        });
        
        // Round values for discrete mode
        if (isDiscrete) {
            minSlider.value = Math.round(parseFloat(minSlider.value));
            maxSlider.value = Math.round(parseFloat(maxSlider.value));
            minInput.value = minSlider.value;
            maxInput.value = maxSlider.value;
            minDisplay.textContent = minSlider.value;
            maxDisplay.textContent = maxSlider.value;
            
            if (comparisonMode) {
                minSlider2.value = Math.round(parseFloat(minSlider2.value));
                maxSlider2.value = Math.round(parseFloat(maxSlider2.value));
                minInput2.value = minSlider2.value;
                maxInput2.value = maxSlider2.value;
                minDisplay2.textContent = minSlider2.value;
                maxDisplay2.textContent = maxSlider2.value;
            }
        }
    }

    function generatePlot() {
        if (isInitialLoad) {
            loadingSpinner.classList.remove('d-none');
            plotImage.style.display = 'none';
        }

        const a = minSlider.value;
        const b = maxSlider.value;
        const discrete = discreteSwitch.checked;
        
        let url = `/generate_uniform_plot?a=${a}&b=${b}&discrete=${discrete}`;
        url += `&show_mean=${showMean.checked}`;
        url += `&show_quartiles=${showQuartiles.checked}`;
        url += `&show_probabilities=${showProbabilities.checked}`;
        url += `&show_cdf=${showCDF.checked}`;
        url += `&show_grid=${showGrid.checked}`;
        
        if (comparisonMode) {
            const a2 = minSlider2.value;
            const b2 = maxSlider2.value;
            url += `&comparison=true&a2=${a2}&b2=${b2}`;
        }

        fetch(url)
            .then(response => response.json())
            .then(data => {
                plotImage.src = 'data:image/png;base64,' + data.plot;
                plotImage.style.display = 'block';
                if (isInitialLoad) {
                    loadingSpinner.classList.add('d-none');
                    isInitialLoad = false;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                if (isInitialLoad) {
                    loadingSpinner.classList.add('d-none');
                    isInitialLoad = false;
                }
            });
    }

    function debounceUpdate() {
        updateStats();
        updateSliderSteps();
        clearTimeout(updateTimeout);
        updateTimeout = setTimeout(generatePlot, 200);
    }

    // Sync sliders with number inputs
    function syncControls() {
        minSlider.addEventListener('input', function() {
            const value = discreteSwitch.checked ? Math.round(this.value) : this.value;
            minDisplay.textContent = value;
            minInput.value = value;
            this.value = value;
            if (parseFloat(value) >= parseFloat(maxSlider.value)) {
                const newMax = parseFloat(value) + (discreteSwitch.checked ? 1 : 0.1);
                maxSlider.value = newMax;
                maxInput.value = newMax;
                maxDisplay.textContent = newMax;
            }
            debounceUpdate();
        });

        minInput.addEventListener('input', function() {
            const value = discreteSwitch.checked ? Math.round(this.value) : this.value;
            if (value >= 0 && value <= 50) {
                minSlider.value = value;
                minDisplay.textContent = value;
                this.value = value;
                debounceUpdate();
            }
        });

        maxSlider.addEventListener('input', function() {
            const value = discreteSwitch.checked ? Math.round(this.value) : this.value;
            maxDisplay.textContent = value;
            maxInput.value = value;
            this.value = value;
            if (parseFloat(value) <= parseFloat(minSlider.value)) {
                const newMin = parseFloat(value) - (discreteSwitch.checked ? 1 : 0.1);
                minSlider.value = Math.max(0, newMin);
                minInput.value = minSlider.value;
                minDisplay.textContent = minSlider.value;
            }
            debounceUpdate();
        });

        maxInput.addEventListener('input', function() {
            const value = discreteSwitch.checked ? Math.round(this.value) : this.value;
            if (value >= 1 && value <= 50) {
                maxSlider.value = value;
                maxDisplay.textContent = value;
                this.value = value;
                debounceUpdate();
            }
        });

        // Comparison controls
        if (minSlider2) {
            minSlider2.addEventListener('input', function() {
                const value = discreteSwitch.checked ? Math.round(this.value) : this.value;
                minDisplay2.textContent = value;
                minInput2.value = value;
                this.value = value;
                debounceUpdate();
            });

            minInput2.addEventListener('input', function() {
                const value = discreteSwitch.checked ? Math.round(this.value) : this.value;
                if (value >= 0 && value <= 50) {
                    minSlider2.value = value;
                    minDisplay2.textContent = value;
                    this.value = value;
                    debounceUpdate();
                }
            });

            maxSlider2.addEventListener('input', function() {
                const value = discreteSwitch.checked ? Math.round(this.value) : this.value;
                maxDisplay2.textContent = value;
                maxInput2.value = value;
                this.value = value;
                debounceUpdate();
            });

            maxInput2.addEventListener('input', function() {
                const value = discreteSwitch.checked ? Math.round(this.value) : this.value;
                if (value >= 1 && value <= 50) {
                    maxSlider2.value = value;
                    maxDisplay2.textContent = value;
                    this.value = value;
                    debounceUpdate();
                }
            });
        }
    }

    // Button event handlers
    diceExampleBtn.addEventListener('click', function() {
        setDistribution(1, 6, true);
        this.classList.add('active');
        setTimeout(() => this.classList.remove('active'), 200);
    });

    coinExampleBtn.addEventListener('click', function() {
        setDistribution(0, 1, true);
        this.classList.add('active');
        setTimeout(() => this.classList.remove('active'), 200);
    });

    timeExampleBtn.addEventListener('click', function() {
        setDistribution(0, 60, false);
        this.classList.add('active');
        setTimeout(() => this.classList.remove('active'), 200);
    });

    compareModeBtn.addEventListener('click', function() {
        comparisonMode = !comparisonMode;
        if (comparisonMode) {
            comparisonControls.classList.remove('d-none');
            this.classList.add('btn-warning');
            this.classList.remove('btn-outline-warning');
        } else {
            comparisonControls.classList.add('d-none');
            this.classList.remove('btn-warning');
            this.classList.add('btn-outline-warning');
        }
        debounceUpdate();
    });

    simulationModeBtn.addEventListener('click', function() {
        simulationMode = !simulationMode;
        if (simulationMode) {
            simulationPanel.style.display = 'block';
            this.classList.add('btn-danger');
            this.classList.remove('btn-outline-danger');
        } else {
            simulationPanel.style.display = 'none';
            this.classList.remove('btn-danger');
            this.classList.add('btn-outline-danger');
        }
    });

    resetAllBtn.addEventListener('click', function() {
        setDistribution(0, 10, false);
        comparisonMode = false;
        simulationMode = false;
        comparisonControls.classList.add('d-none');
        simulationPanel.style.display = 'none';
        compareModeBtn.classList.remove('btn-warning');
        compareModeBtn.classList.add('btn-outline-warning');
        simulationModeBtn.classList.remove('btn-danger');
        simulationModeBtn.classList.add('btn-outline-danger');
        showMean.checked = false;
        showQuartiles.checked = false;
        showProbabilities.checked = false;
        showCDF.checked = false;
        showGrid.checked = true;
        probResult.classList.add('d-none');
        simulationResults.classList.add('d-none');
        this.classList.add('active');
        setTimeout(() => this.classList.remove('active'), 200);
        debounceUpdate();
    });

    // Discrete/Continuous switch
    discreteSwitch.addEventListener('change', debounceUpdate);

    // Checkbox event handlers
    [showMean, showQuartiles, showProbabilities, showCDF, showGrid].forEach(checkbox => {
        checkbox.addEventListener('change', debounceUpdate);
    });

    // Probability calculator
    probType.addEventListener('change', function() {
        if (this.value === 'between') {
            probValue2Container.style.display = 'block';
        } else {
            probValue2Container.style.display = 'none';
        }
    });

    calculateProbBtn.addEventListener('click', function() {
        const a = parseFloat(minSlider.value);
        const b = parseFloat(maxSlider.value);
        const value1 = parseFloat(probValue1.value);
        const value2 = parseFloat(probValue2.value);
        const type = probType.value;
        const isDiscrete = discreteSwitch.checked;

        let probability, resultText;

        switch(type) {
            case 'less':
                if (isDiscrete) {
                    if (value1 <= a) {
                        probability = 0;
                    } else if (value1 > b) {
                        probability = 1;
                    } else {
                        const n = Math.floor(b) - Math.floor(a) + 1;
                        const count = Math.floor(value1) - Math.floor(a);
                        probability = count / n;
                    }
                } else {
                    if (value1 <= a) {
                        probability = 0;
                    } else if (value1 >= b) {
                        probability = 1;
                    } else {
                        probability = (value1 - a) / (b - a);
                    }
                }
                resultText = `P(X < ${value1}) = ${probability.toFixed(4)} (${(probability * 100).toFixed(2)}%)`;
                break;
                
            case 'greater':
                if (isDiscrete) {
                    if (value1 >= b) {
                        probability = 0;
                    } else if (value1 < a) {
                        probability = 1;
                    } else {
                        const n = Math.floor(b) - Math.floor(a) + 1;
                        const count = Math.floor(b) - Math.floor(value1);
                        probability = count / n;
                    }
                } else {
                    if (value1 >= b) {
                        probability = 0;
                    } else if (value1 <= a) {
                        probability = 1;
                    } else {
                        probability = (b - value1) / (b - a);
                    }
                }
                resultText = `P(X > ${value1}) = ${probability.toFixed(4)} (${(probability * 100).toFixed(2)}%)`;
                break;
                
            case 'between':
                if (value1 >= value2) {
                    resultText = 'Error: Value (a) must be less than Value (b)';
                    break;
                }
                if (isDiscrete) {
                    const n = Math.floor(b) - Math.floor(a) + 1;
                    const lowerBound = Math.max(Math.ceil(value1), a);
                    const upperBound = Math.min(Math.floor(value2), b);
                    const count = Math.max(0, upperBound - lowerBound + 1);
                    probability = count / n;
                } else {
                    const lowerBound = Math.max(value1, a);
                    const upperBound = Math.min(value2, b);
                    const range = Math.max(0, upperBound - lowerBound);
                    probability = range / (b - a);
                }
                resultText = `P(${value1} ≤ X ≤ ${value2}) = ${probability.toFixed(4)} (${(probability * 100).toFixed(2)}%)`;
                break;
                
            case 'equal':
                if (isDiscrete) {
                    if (value1 >= a && value1 <= b && Number.isInteger(value1)) {
                        const n = Math.floor(b) - Math.floor(a) + 1;
                        probability = 1 / n;
                        resultText = `P(X = ${value1}) = ${probability.toFixed(4)} (${(probability * 100).toFixed(2)}%)`;
                    } else {
                        resultText = `P(X = ${value1}) = 0 (value not in domain or not integer)`;
                    }
                } else {
                    resultText = 'P(X = value) = 0 for continuous distributions';
                }
                break;
        }

        probResultText.innerHTML = `<strong>${resultText}</strong>`;
        probResult.classList.remove('d-none');
    });

    // Simulation functionality
    simSamples.addEventListener('input', function() {
        simSamplesValue.textContent = this.value;
    });

    simBins.addEventListener('input', function() {
        simBinsValue.textContent = this.value;
    });

    runSimulationBtn.addEventListener('click', function() {
        const a = parseFloat(minSlider.value);
        const b = parseFloat(maxSlider.value);
        const n = parseInt(simSamples.value);
        const bins = parseInt(simBins.value);
        const isDiscrete = discreteSwitch.checked;
        
        // Generate uniform random samples
        let samples = [];
        for (let i = 0; i < n; i++) {
            if (isDiscrete) {
                samples.push(Math.floor(Math.random() * (Math.floor(b) - Math.floor(a) + 1)) + Math.floor(a));
            } else {
                samples.push(Math.random() * (b - a) + a);
            }
        }
        
        // Calculate sample statistics
        const sampleMean = samples.reduce((sum, x) => sum + x, 0) / n;
        const sampleVariance = samples.reduce((sum, x) => sum + (x - sampleMean) ** 2, 0) / (n - 1);
        
        // Calculate theoretical statistics
        const theorMean = (a + b) / 2;
        let theorVariance;
        if (isDiscrete) {
            const numValues = Math.floor(b) - Math.floor(a) + 1;
            theorVariance = ((numValues * numValues) - 1) / 12;
        } else {
            theorVariance = ((b - a) ** 2) / 12;
        }
        
        // Display results
        document.getElementById('simMean').textContent = sampleMean.toFixed(3);
        document.getElementById('simVariance').textContent = sampleVariance.toFixed(3);
        document.getElementById('theoreticalMean').textContent = theorMean.toFixed(3);
        document.getElementById('theoreticalVariance').textContent = theorVariance.toFixed(3);
        
        simulationResults.classList.remove('d-none');
        
        this.classList.add('btn-success');
        this.innerHTML = '<i class="fas fa-check me-1"></i>Simulation Complete!';
        setTimeout(() => {
            this.classList.remove('btn-success');
            this.innerHTML = '<i class="fas fa-play me-1"></i>Run Simulation';
        }, 2000);
    });

    // Utility function to set distribution parameters
    function setDistribution(min, max, discrete) {
        minSlider.value = min;
        maxSlider.value = max;
        minInput.value = min;
        maxInput.value = max;
        minDisplay.textContent = min;
        maxDisplay.textContent = max;
        discreteSwitch.checked = discrete;
        debounceUpdate();
    }

    // Global function for example buttons
    window.setExample = function(type) {
        switch(type) {
            case 'dice':
                setDistribution(1, 6, true);
                break;
            case 'card':
                setDistribution(1, 13, true);
                break;
            case 'time':
                setDistribution(0, 15, false);
                break;
            case 'random':
                setDistribution(0, 1, false);
                break;
        }
    };

    // Initialize
    syncControls();
    updateStats();
    updateSliderSteps();
    generatePlot();
});
</script>

<style>
/* Quiz specific styles */
.quiz-options {
    margin: 15px 0;
}

.quiz-options .form-check {
    margin-bottom: 10px;
    padding: 8px;
    border-radius: 5px;
    transition: background-color 0.2s ease;
}

.quiz-options .form-check:hover {
    background-color: #f8f9fa;
}

.quiz-options .form-check-input:checked + .form-check-label {
    font-weight: bold;
    color: #007bff;
}

.quiz-feedback {
    min-height: 20px;
}

.quiz-feedback .alert {
    margin-bottom: 0;
    padding: 8px 12px;
    font-size: 0.9em;
}
</style>
{% endblock %}